{"version":3,"sources":["../../../src/bot/menus.ts","../../../src/lib/cloudflare.ts","../../../src/bot/handlers.ts"],"sourcesContent":["import { Menu } from \"@grammyjs/menu\";\r\nimport { InlineKeyboard } from \"grammy\";\r\n\r\n// Main Menu\r\nexport const mainMenuKeyboard = new InlineKeyboard()\r\n    .text(\"üß™ Cek IP Proxy\", \"action_check_ip\").row()\r\n    .text(\"üåê Buat VLESS\", \"action_create_vless\").text(\"üé≤ VLESS Random\", \"action_random_vless\").row()\r\n    .text(\"üìÑ List VLESS\", \"action_list_vless\").text(\"üìä All Status\", \"action_all_status\").row()\r\n    .text(\"üîç Cek Status VLESS\", \"action_check_status_vless\").text(\"üåç List Wildcard\", \"action_list_wildcard\").row()\r\n    .text(\"üîó Get Sub Link\", \"action_get_sub_link\").text(\"üìà Data Pemakaian\", \"action_usage_data\").row()\r\n    .text(\"üíù Donasi\", \"action_donate\").text(\"üõ† Admin Menu\", \"action_admin_menu\");\r\n\r\n// Injection Method Menu (WS, SNI, WILDCARD)\r\nexport const methodKeyboard = new InlineKeyboard()\r\n    .text(\"WS\", \"method_ws\").text(\"SNI\", \"method_sni\").row()\r\n    .text(\"WILDCARD\", \"method_wildcard\").row()\r\n    .text(\"‚¨ÖÔ∏è Kembali\", \"menu_main\");\r\n\r\n// Admin Menu (New Structure)\r\nexport const adminKeyboard = new InlineKeyboard()\r\n    .text(\"‚öôÔ∏è Pengaturan API CF\", \"admin_cf_settings\").row()\r\n    .text(\"‚ûï Add Proxy\", \"admin_add_proxy\").text(\"üóë Del Proxy\", \"admin_del_proxy\").row()\r\n    .text(\"üìä Statistik & Monitor\", \"admin_stats\").row()\r\n    .text(\"‚¨ÖÔ∏è Kembali\", \"menu_main\");\r\n\r\n// Sub-menu: CF Settings\r\nexport const cfSettingsKeyboard = new InlineKeyboard()\r\n    .text(\"üîê Akun CF VPN\", \"admin_list_cf_vpn\").row()\r\n    .text(\"üì° Akun CF Feeder\", \"admin_cf_feeder\").row()\r\n    .text(\"üì• Tambah Akun Baru\", \"admin_add_cf_account\").row()\r\n    .text(\"‚¨ÖÔ∏è Kembali\", \"action_admin_menu\");\r\n\r\n// Sub Link Menu\r\nexport const subLinkTypeKeyboard = new InlineKeyboard()\r\n    .text(\"VLESS\", \"sub_type_vless\").text(\"CLASH\", \"sub_type_clash\").row()\r\n    .text(\"‚¨ÖÔ∏è Kembali\", \"menu_main\");\r\n\r\nexport const subLinkMethodKeyboard = new InlineKeyboard()\r\n    .text(\"WS\", \"sub_method_ws\").text(\"SNI\", \"sub_method_sni\").row()\r\n    .text(\"WILDCARD\", \"sub_method_wildcard\").row()\r\n    .text(\"‚¨ÖÔ∏è Kembali\", \"menu_main\");\r\n\r\n// Dynamic Generators\r\nexport function generateServerListKeyboard(servers: { country: string, flag: string, name: string, subdomain: string }[]) {\r\n    const kb = new InlineKeyboard();\r\n    servers.forEach((s) => {\r\n        kb.text(`(${s.country}) ${s.name} ${s.flag}`, `select_server_${s.subdomain}`).row();\r\n    });\r\n    kb.text(\"‚¨ÖÔ∏è Kembali\", \"menu_main\");\r\n    return kb;\r\n}\r\n\r\nexport function generateWildcardListKeyboard(subdomains: string[]) {\r\n    const kb = new InlineKeyboard();\r\n    subdomains.forEach((s) => {\r\n        kb.text(s, `select_wildcard_${s}`).row();\r\n    });\r\n    kb.text(\"‚¨ÖÔ∏è Kembali\", \"menu_main\");\r\n    return kb;\r\n}\r\n\r\nexport const backToMainKeyboard = new InlineKeyboard().text(\"‚¨ÖÔ∏è Kembali\", \"menu_main\");\r\n","export type CFAuth = {\r\n    email: string;\r\n    apiKey: string; // Global API Key or Token\r\n    accountId: string;\r\n};\r\n\r\nconst CF_API_URL = \"https://api.cloudflare.com/client/v4\";\r\n\r\nasync function cfRequest(endpoint: string, method: string, auth: CFAuth, body?: any) {\r\n    const headers: Record<string, string> = {\r\n        \"Content-Type\": \"application/json\",\r\n    };\r\n\r\n    // Support both Token (Bearer) and Global Key (X-Auth)\r\n    if (auth.apiKey.startsWith(\"Bearer \")) {\r\n        headers[\"Authorization\"] = auth.apiKey;\r\n    } else {\r\n        headers[\"X-Auth-Email\"] = auth.email;\r\n        headers[\"X-Auth-Key\"] = auth.apiKey;\r\n    }\r\n\r\n    const response = await fetch(`${CF_API_URL}${endpoint}`, {\r\n        method,\r\n        headers,\r\n        body: body ? JSON.stringify(body) : undefined,\r\n    });\r\n\r\n    const data = await response.json();\r\n    if (!data.success) {\r\n        throw new Error(`CF API Error: ${data.errors[0]?.message || JSON.stringify(data.errors)}`);\r\n    }\r\n    return data.result;\r\n}\r\n\r\nexport async function uploadWorker(auth: CFAuth, workerName: string, scriptContent: string) {\r\n    // Upload config and script. For simple Module workers, we upload metadata + part.\r\n    // Ease of use: use the standard script upload endpoint (PUT /accounts/:id/workers/scripts/:name)\r\n    // Note: This requires the script to be valid JS/Module.\r\n\r\n    // We need to send it as a FormData or raw JS depending on type.\r\n    // For simplicity, we assume standard ES Module worker.\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"metadata\", JSON.stringify({ main_module: \"index.js\", compatibility_date: \"2023-01-01\" }));\r\n    formData.append(\"index.js\", new Blob([scriptContent], { type: \"application/javascript+module\" }));\r\n\r\n    // Need to use raw fetch for FormData to let browser/node handle boundary\r\n    const headers: Record<string, string> = {};\r\n    if (auth.apiKey.startsWith(\"Bearer \")) {\r\n        headers[\"Authorization\"] = auth.apiKey;\r\n    } else {\r\n        headers[\"X-Auth-Email\"] = auth.email;\r\n        headers[\"X-Auth-Key\"] = auth.apiKey;\r\n    }\r\n\r\n    const res = await fetch(`${CF_API_URL}/accounts/${auth.accountId}/workers/scripts/${workerName}`, {\r\n        method: \"PUT\",\r\n        headers,\r\n        body: formData,\r\n    });\r\n\r\n    const data = await res.json();\r\n    if (!data.success) {\r\n        throw new Error(`CF Upload Error: ${data.errors[0]?.message || JSON.stringify(data.errors)}`);\r\n    }\r\n    return data.result;\r\n}\r\n\r\n// Support for Custom Domains (better for deep subdomains/SSL)\r\nexport async function addWorkerDomain(auth: CFAuth, accountId: string, workerName: string, hostname: string, zoneId: string) {\r\n    return cfRequest(`/accounts/${accountId}/workers/domains`, \"PUT\", auth, {\r\n        hostname,\r\n        service: workerName,\r\n        zone_id: zoneId\r\n    });\r\n}\r\n\r\nexport async function addWorkerRoute(auth: CFAuth, zoneId: string, pattern: string, workerName: string) {\r\n    return cfRequest(`/zones/${zoneId}/workers/routes`, \"POST\", auth, {\r\n        pattern,\r\n        script: workerName,\r\n    });\r\n}\r\n\r\nexport async function createDNSRecord(auth: CFAuth, zoneId: string, name: string, content: string = \"192.0.2.1\", type: string = \"A\", proxied: boolean = true) {\r\n    return cfRequest(`/zones/${zoneId}/dns_records`, \"POST\", auth, {\r\n        type,\r\n        name,\r\n        content,\r\n        proxied,\r\n        ttl: 1 // automatic\r\n    });\r\n}\r\n\r\nexport async function getZones(auth: CFAuth) {\r\n    return cfRequest(`/zones`, \"GET\", auth);\r\n}\r\n\r\nexport async function updateWorkerCron(auth: CFAuth, workerName: string, crons: string[]) {\r\n    return cfRequest(`/accounts/${auth.accountId}/workers/scripts/${workerName}/schedules`, \"PUT\", auth, [\r\n        { cron: crons[0] } // Getting simple here, usually array of objects\r\n    ]);\r\n}\r\n\r\nexport async function updateWorkerEnv(auth: CFAuth, workerName: string, envVars: Record<string, string>) {\r\n    // Fetch existing bindings/settings first? Simpler to just PUT settings if possible.\r\n    // Cloudflare API for bindings is complex. We might need to use the `metadata` part of the uploadWorker, \r\n    // BUT specific environment variable update endpoint is easier if available.\r\n    // Actually, creating a valid metadata blob during upload is better, but let's try a dedicated endpoint or metadata update.\r\n    // NOTE: The standard API to update settings is PATCH /scripts/{name}/settings\r\n\r\n    const bindings = Object.entries(envVars).map(([key, value]) => ({\r\n        type: \"plain_text\",\r\n        name: key,\r\n        text: value\r\n    }));\r\n\r\n    return cfRequest(`/accounts/${auth.accountId}/workers/scripts/${workerName}/settings`, \"PATCH\", auth, {\r\n        bindings\r\n    });\r\n}\r\n","import { Bot, Context, session, SessionFlavor, InlineKeyboard } from \"grammy\";\r\nimport {\r\n    mainMenuKeyboard,\r\n    methodKeyboard,\r\n    generateServerListKeyboard,\r\n    generateWildcardListKeyboard,\r\n    subLinkTypeKeyboard,\r\n    subLinkMethodKeyboard,\r\n    adminKeyboard,\r\n    cfSettingsKeyboard,\r\n    backToMainKeyboard\r\n} from \"./menus\";\r\nimport { db } from \"../lib/db\";\r\nimport { CFAuth, uploadWorker, addWorkerDomain, addWorkerRoute, updateWorkerCron, updateWorkerEnv } from \"../lib/cloudflare\";\r\nimport { Conversation, ConversationFlavor } from \"@grammyjs/conversations\";\r\n\r\n// Define Session Structure\r\nexport interface SessionData {\r\n    temp: {\r\n        selectedServer?: { subdomain: string, country: string, flag: string, name: string };\r\n        selectedMethod?: \"ws\" | \"sni\" | \"wildcard\";\r\n        subType?: \"vless\" | \"clash\";\r\n        bug?: string;\r\n    };\r\n}\r\n\r\n// 1. Base Context with Session\r\nexport type MySessionContext = Context & SessionFlavor<SessionData>;\r\n\r\n// 2. Final Context with Conversation\r\nexport type MyContext = MySessionContext & ConversationFlavor<MySessionContext>;\r\n\r\n// 3. Conversational Context\r\nexport type MyConversation = Conversation<MySessionContext>;\r\n\r\n// Main Setup Function\r\nexport function setupHandlers(bot: Bot<MyContext>) {\r\n\r\n    // --- Main Menu Actions ---\r\n    bot.callbackQuery(\"action_create_vless\", async (ctx) => {\r\n        // 1. Fetch Servers from DB\r\n        const workers = await db.execute(\"SELECT * FROM workers WHERE type='vless'\");\r\n        const servers = workers.rows.map(r => ({\r\n            country: r.country_code as string,\r\n            flag: r.flag as string,\r\n            name: r.worker_name as string,\r\n            subdomain: r.subdomain as string\r\n        }));\r\n\r\n        if (servers.length === 0) {\r\n            return ctx.editMessageText(\"‚ö†Ô∏è Belum ada server yang tersedia. Hubungi Admin.\", { reply_markup: mainMenuKeyboard });\r\n        }\r\n\r\n        await ctx.editMessageText(\"Pilih server untuk membuat VLESS:\", {\r\n            reply_markup: generateServerListKeyboard(servers)\r\n        });\r\n    });\r\n\r\n    bot.callbackQuery(\"menu_main\", async (ctx) => {\r\n        await ctx.editMessageText(\"Selamat datang di bot VLESS Worker.\\n\\nSilahkan pilih menu di bawah ini:\", {\r\n            reply_markup: mainMenuKeyboard\r\n        });\r\n    });\r\n\r\n    // --- Server Selection ---\r\n    bot.callbackQuery(/^select_server_(.+)$/, async (ctx) => {\r\n        const subdomain = ctx.match[1];\r\n        const res = await db.execute({ sql: \"SELECT * FROM workers WHERE subdomain = ?\", args: [subdomain] });\r\n        const worker = res.rows[0];\r\n\r\n        ctx.session.temp = {\r\n            selectedServer: {\r\n                subdomain: subdomain,\r\n                country: worker.country_code as string,\r\n                flag: worker.flag as string,\r\n                name: worker.worker_name as string\r\n            }\r\n        };\r\n\r\n        await ctx.editMessageText(`‚úÖ Server Terpilih: ${worker.worker_name} ${worker.flag}\\n\\nPilih metode inject:`, {\r\n            reply_markup: methodKeyboard\r\n        });\r\n    });\r\n\r\n    // --- Method Selection ---\r\n    bot.callbackQuery(\"method_ws\", async (ctx) => {\r\n        if (!ctx.session.temp) ctx.session.temp = {};\r\n        ctx.session.temp.selectedMethod = \"ws\";\r\n        await ctx.reply(\"‚ö° Kirimkan BUG WS yang ingin digunakan.\");\r\n        await ctx.conversation.enter(\"inputBugConversation\");\r\n    });\r\n\r\n    bot.callbackQuery([\"method_sni\", \"method_wildcard\"], async (ctx) => {\r\n        const method = ctx.callbackQuery.data === \"method_sni\" ? \"sni\" : \"wildcard\";\r\n        if (!ctx.session.temp) ctx.session.temp = {};\r\n        ctx.session.temp.selectedMethod = method;\r\n\r\n        // Show Subdomain List\r\n        const workers = await db.execute(\"SELECT subdomain FROM workers WHERE type='vless'\");\r\n        const subdomains = workers.rows.map(r => r.subdomain as string);\r\n\r\n        await ctx.editMessageText(`Pilih salah satu subdomain untuk metode ${method.toUpperCase()}:`, {\r\n            reply_markup: generateWildcardListKeyboard(subdomains)\r\n        });\r\n    });\r\n\r\n    // --- Wildcard/SNI Selection ---\r\n    bot.callbackQuery(/^select_wildcard_(.+)$/, async (ctx) => {\r\n        const selectedSub = ctx.match[1];\r\n        // Logic:\r\n        // If SNI: Host = selectedSub\r\n        // If Wildcard: Host = selectedSub.workerDomain\r\n        await generateAndShowResult(ctx, selectedSub);\r\n    });\r\n\r\n    // --- Admin Actions ---\r\n    bot.callbackQuery(\"action_admin_menu\", async (ctx) => {\r\n        if (!isAdmin(ctx)) return ctx.reply(\"‚õî Akses Ditolak.\");\r\n        await ctx.editMessageText(\"üõ† Admin Menu\", { reply_markup: adminKeyboard });\r\n    });\r\n\r\n    bot.callbackQuery(\"admin_cf_settings\", async (ctx) => {\r\n        if (!isAdmin(ctx)) return;\r\n        await ctx.editMessageText(\"‚öôÔ∏è Pengaturan API CF\", { reply_markup: cfSettingsKeyboard });\r\n    });\r\n\r\n    bot.callbackQuery(\"admin_add_proxy\", async (ctx) => {\r\n        if (!isAdmin(ctx)) return;\r\n        await ctx.conversation.enter(\"addProxyConversation\");\r\n    });\r\n\r\n    bot.callbackQuery(\"admin_add_cf_account\", async (ctx) => {\r\n        await ctx.conversation.enter(\"addCfAccountConversation\");\r\n    });\r\n\r\n    bot.callbackQuery(\"admin_cf_feeder\", async (ctx) => {\r\n        if (!isAdmin(ctx)) return;\r\n        await ctx.conversation.enter(\"addFeederConversation\");\r\n    });\r\n\r\n    // --- User Features ---\r\n\r\n    // Check IP\r\n    bot.callbackQuery(\"action_check_ip\", async (ctx) => {\r\n        if (!ctx.chat) return;\r\n        await ctx.editMessageText(\"‚è≥ Checking IP...\", { reply_markup: backToMainKeyboard });\r\n        try {\r\n            const res = await fetch(\"https://api.ipify.org?format=json\");\r\n            const data = await res.json() as { ip: string };\r\n            await ctx.editMessageText(`üìç <b>Worker IP:</b> <code>${data.ip}</code>`, { parse_mode: \"HTML\", reply_markup: backToMainKeyboard });\r\n        } catch (e) {\r\n            await ctx.editMessageText(\"‚ùå Gagal cek IP.\", { reply_markup: backToMainKeyboard });\r\n        }\r\n    });\r\n\r\n    // List VLESS\r\n    bot.callbackQuery(\"action_list_vless\", async (ctx) => {\r\n        const workers = await db.execute(\"SELECT worker_name, country_code, flag, subdomain FROM workers WHERE type='vless'\");\r\n        if (workers.rows.length === 0) return ctx.editMessageText(\"‚ö†Ô∏è Belum ada server.\", { reply_markup: backToMainKeyboard });\r\n\r\n        let text = \"üìÑ <b>List VLESS Server:</b>\\n\\n\";\r\n        workers.rows.forEach((w, i) => {\r\n            text += `${i + 1}. ${w.flag} <b>${w.worker_name}</b>\\n   <code>${w.subdomain}</code>\\n\\n`;\r\n        });\r\n        await ctx.editMessageText(text, { parse_mode: \"HTML\", reply_markup: backToMainKeyboard });\r\n    });\r\n\r\n    // List Wildcard\r\n    bot.callbackQuery(\"action_list_wildcard\", async (ctx) => {\r\n        const workers = await db.execute(\"SELECT subdomain FROM workers WHERE type='vless'\");\r\n        if (workers.rows.length === 0) return ctx.editMessageText(\"‚ö†Ô∏è Belum ada server.\", { reply_markup: backToMainKeyboard });\r\n\r\n        // This is simplified. Real wildcard list usually implies domains that support wildcard.\r\n        // We assume all workers support wildcard if configured correctly.\r\n        let text = \"üåç <b>List Domain Wildcard:</b>\\n\\n\";\r\n        workers.rows.forEach((w) => {\r\n            text += `‚Ä¢ <code>${w.subdomain}</code>\\n`;\r\n        });\r\n        await ctx.editMessageText(text, { parse_mode: \"HTML\", reply_markup: backToMainKeyboard });\r\n    });\r\n\r\n    // Donate\r\n    bot.callbackQuery(\"action_donate\", async (ctx) => {\r\n        await ctx.editMessageText(\"üíù <b>Donasi Pengembangan Bot</b>\\n\\nSilahkan kontak admin: @garword\", { parse_mode: \"HTML\", reply_markup: backToMainKeyboard });\r\n    });\r\n\r\n    // Usage Data\r\n    bot.callbackQuery(\"action_usage_data\", async (ctx) => {\r\n        // Placeholder: CF Analytics API is heavy.\r\n        await ctx.editMessageText(\"üìà <b>Data Pemakaian</b>\\n\\nFitur ini memerlukan integrasi GraphQL Cloudflare yang lebih dalam. Saat ini belum tersedia.\", { parse_mode: \"HTML\", reply_markup: backToMainKeyboard });\r\n    });\r\n\r\n    // Get Sub Link\r\n    bot.callbackQuery(\"action_get_sub_link\", async (ctx) => {\r\n        await ctx.editMessageText(\"üîó Pilih Tipe Subscription:\", { reply_markup: subLinkTypeKeyboard });\r\n    });\r\n\r\n    bot.callbackQuery(/^sub_type_(.+)$/, async (ctx) => {\r\n        const type = ctx.match[1];\r\n        ctx.session.temp = { subType: type as any };\r\n        await ctx.editMessageText(\"üîó Pilih Metode:\", { reply_markup: subLinkMethodKeyboard });\r\n    });\r\n\r\n    bot.callbackQuery(/^sub_method_(.+)$/, async (ctx) => {\r\n        const method = ctx.match[1];\r\n        const type = ctx.session.temp?.subType || \"vless\";\r\n\r\n        // Construct Link\r\n        // ... (existing comments)\r\n\r\n        await ctx.editMessageText(\"‚ùå URL Bot belum diset di Database Settings. Gunakan menu Admin Feeder untuk set URL Bot output.\", { reply_markup: backToMainKeyboard });\r\n        // Correct fix: Store URL during feeder setup.\r\n    });\r\n\r\n    // Admin List CF VPN\r\n    bot.callbackQuery(\"admin_list_cf_vpn\", async (ctx) => {\r\n        if (!isAdmin(ctx)) return;\r\n        const accs = await db.execute(\"SELECT email, account_id FROM cf_accounts\");\r\n        if (accs.rows.length === 0) return ctx.editMessageText(\"‚ö†Ô∏è Belum ada akun CF tersimpan.\", { reply_markup: backToMainKeyboard });\r\n\r\n        let text = \"üîê <b>List Akun Cloudflare:</b>\\n\\n\";\r\n        accs.rows.forEach((a, i) => {\r\n            text += `${i + 1}. ${a.email}\\n   ID: <code>${a.account_id}</code>\\n\\n`;\r\n        });\r\n        await ctx.editMessageText(text, { parse_mode: \"HTML\", reply_markup: backToMainKeyboard });\r\n    });\r\n\r\n    // Admin Del Proxy Implementation\r\n    bot.callbackQuery(\"admin_del_proxy\", async (ctx) => {\r\n        if (!isAdmin(ctx)) return;\r\n        const workers = await db.execute(\"SELECT id, worker_name, subdomain FROM workers\");\r\n        if (workers.rows.length === 0) return ctx.editMessageText(\"‚ö†Ô∏è Tidak ada proxy untuk dihapus.\", { reply_markup: backToMainKeyboard });\r\n\r\n        const kb = new InlineKeyboard();\r\n        workers.rows.forEach(w => {\r\n            kb.text(`üóë ${w.worker_name}`, `del_proxy_${w.id}`).row();\r\n        });\r\n        kb.text(\"‚¨ÖÔ∏è Batal\", \"menu_main\");\r\n\r\n        await ctx.editMessageText(\"Pilih Proxy yang akan dihapus (Hanya DB):\", { reply_markup: kb });\r\n    });\r\n\r\n    bot.callbackQuery(/^del_proxy_(.+)$/, async (ctx) => {\r\n        if (!isAdmin(ctx)) return;\r\n        const id = ctx.match[1];\r\n        await db.execute({ sql: \"DELETE FROM workers WHERE id = ?\", args: [id] });\r\n        await ctx.editMessageText(\"‚úÖ Proxy berhasil dihapus dari Database.\", { reply_markup: backToMainKeyboard });\r\n    });\r\n\r\n}\r\n\r\n// Helper: Check Admin\r\nfunction isAdmin(ctx: MyContext) {\r\n    const adminIds = process.env.ADMIN_IDS?.split(\",\").map(Number) || [];\r\n    return adminIds.includes(ctx.from?.id || 0);\r\n}\r\n\r\n// Conversation: Member Add CF Account\r\n// Helper: Clean up conversation messages\r\nasync function cleanupConversation(ctx: MyContext, userMsgId?: number, botMsgId?: number) {\r\n    if (userMsgId) await ctx.api.deleteMessage(ctx.chat?.id!, userMsgId).catch(() => { });\r\n    if (botMsgId) await ctx.api.deleteMessage(ctx.chat?.id!, botMsgId).catch(() => { });\r\n}\r\n\r\n// Conversation: Member Add CF Account\r\nexport async function addCfAccountConversation(conversation: MyConversation, ctx: MyContext) {\r\n    const prompt1 = await ctx.reply(\"üìß Masukkan Email Cloudflare Anda:\");\r\n    const emailMsg = await conversation.wait();\r\n    const email = emailMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (emailMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, emailMsg.message.message_id).catch(() => { });\r\n\r\n    if (!email || email.toLowerCase() === \"batal\" || email.toLowerCase() === \"cancel\") {\r\n        await cleanupConversation(ctx, undefined, prompt1.message_id);\r\n        return;\r\n    }\r\n\r\n    const prompt2 = await ctx.reply(\"üîë Masukkan Global API Key / Token:\");\r\n    const keyMsg = await conversation.wait();\r\n    const apiKey = keyMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (keyMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, keyMsg.message.message_id).catch(() => { });\r\n\r\n    if (!apiKey || apiKey.toLowerCase() === \"batal\" || apiKey.toLowerCase() === \"cancel\") {\r\n        await cleanupConversation(ctx, undefined, prompt2.message_id);\r\n        // Ideally should clean previous ones too, but for simplicity just this step.\r\n        return;\r\n    }\r\n\r\n    const prompt3 = await ctx.reply(\"üÜî Masukkan Account ID:\");\r\n    const accMsg = await conversation.wait();\r\n    const accountId = accMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (accMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, accMsg.message.message_id).catch(() => { });\r\n\r\n    if (!accountId || accountId.toLowerCase() === \"batal\" || accountId.toLowerCase() === \"cancel\") {\r\n        await cleanupConversation(ctx, undefined, prompt3.message_id);\r\n        return;\r\n    }\r\n\r\n    if (email && apiKey && accountId) {\r\n        const processMsg = await ctx.reply(\"‚è≥ Memverifikasi & Mendaftarkan Akun...\");\r\n\r\n        try {\r\n            // 1. Save Account\r\n            const res = await db.execute({\r\n                sql: \"INSERT INTO cf_accounts (email, api_key, account_id, owner_id) VALUES (?, ?, ?, ?) RETURNING id\",\r\n                args: [email, apiKey, accountId, ctx.from?.id || 0]\r\n            });\r\n            const dbAccountId = res.rows[0].id;\r\n\r\n            // 2. Auto Deploy Worker\r\n            await ctx.api.editMessageText(ctx.chat?.id!, processMsg.message_id, \"üöÄ Sedang men-deploy VLESS Worker ke akun Anda...\");\r\n\r\n            // Minimal VLESS Script (Placeholder for full implementation)\r\n            const scriptContent = `\r\n            import { connect } from \"cloudflare:sockets\";\r\n            export default {\r\n              async fetch(request, env, ctx) {\r\n                 const upgrade = request.headers.get(\"Upgrade\");\r\n                 if(upgrade === \"websocket\") return new Response(null, { status: 101 });\r\n                 return new Response(\"VLESS Active\", { status: 200 });\r\n              }\r\n            };`;\r\n\r\n            const workerName = `vless-${ctx.from?.id}-${Math.floor(Math.random() * 1000)}`;\r\n            const auth = { email, apiKey, accountId };\r\n\r\n            // Real CF API Call\r\n            await uploadWorker(auth, workerName, scriptContent);\r\n\r\n            let subdomain = `${workerName}.${accountId.substring(0, 4)}.workers.dev`; // Default\r\n            let country = \"ID\";\r\n            let flag = \"üáÆüá©\";\r\n\r\n            // 4. Ask for Custom Domain (Optional)\r\n            await ctx.api.deleteMessage(ctx.chat?.id!, processMsg.message_id).catch(() => { });\r\n\r\n            await ctx.reply(\"üåê Apakah Anda ingin menggunakan **Custom Domain** sendiri? (Support Wildcard/SNI).\\n\\nKetik nama domain (misal: `vip.domainku.com`) atau ketik **skip** untuk menggunakan default.\");\r\n            const domMsg = await conversation.wait();\r\n\r\n            // Delete user input immediately\r\n            if (domMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, domMsg.message.message_id).catch(() => { });\r\n\r\n\r\n            if (domMsg.message?.text && domMsg.message.text.toLowerCase() !== 'skip') {\r\n                const customDomain = domMsg.message.text.toLowerCase();\r\n                const zonePrompt = await ctx.reply(`üÜî Kirimkan **Zone ID** untuk domain ${customDomain}:`);\r\n                const zoneMsg = await conversation.wait();\r\n                const zoneId = zoneMsg.message?.text;\r\n\r\n                if (zoneMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, zoneMsg.message.message_id).catch(() => { });\r\n\r\n                if (zoneId) {\r\n                    await ctx.api.editMessageText(ctx.chat?.id!, zonePrompt.message_id, \"‚öôÔ∏è Mengikat Custom Domain & Routing Wildcard...\");\r\n                    try {\r\n                        // 1. Bind Domain (SSL)\r\n                        await addWorkerDomain(auth, accountId, workerName, customDomain, zoneId);\r\n\r\n                        // 2. Add Route Wildcard (*.domain/*)\r\n                        try {\r\n                            await addWorkerRoute(auth, zoneId, `*.${customDomain}/*`, workerName);\r\n                        } catch (routeErr: any) {\r\n                            // Log error but proceed\r\n                        }\r\n\r\n                        subdomain = customDomain;\r\n                        country = \"US\"; // Assuming changes\r\n                        flag = \"üá∫üá∏\";\r\n                        await ctx.api.editMessageText(ctx.chat?.id!, zonePrompt.message_id, `‚úÖ Domain ${customDomain} berhasil diikat!`);\r\n                    } catch (err: any) {\r\n                        await ctx.api.editMessageText(ctx.chat?.id!, zonePrompt.message_id, `‚ö†Ô∏è Gagal BIND Domain: ${err.message}. Tetap menggunakan subdomain standar.`);\r\n                    }\r\n                }\r\n            }\r\n\r\n            await db.execute({\r\n                sql: \"INSERT INTO workers (subdomain, account_id, worker_name, type, country_code, flag) VALUES (?, ?, ?, 'vless', ?, ?)\",\r\n                args: [subdomain, dbAccountId, workerName, country, flag]\r\n            });\r\n\r\n            await ctx.reply(`‚úÖ Selesai! Worker Anda aktif: ${subdomain}.\\nSiap digunakan untuk WS/SNI/Wildcard Pribadi.`, { reply_markup: backToMainKeyboard });\r\n\r\n        } catch (e: any) {\r\n            await ctx.reply(`‚ùå Gagal: ${e.message}`, { reply_markup: backToMainKeyboard });\r\n        }\r\n    } else {\r\n        await ctx.reply(\"‚ö†Ô∏è Gagal, data tidak lengkap.\", { reply_markup: backToMainKeyboard });\r\n    }\r\n}\r\n\r\n// Conversation: Admin Add Proxy (With Wildcard)\r\nexport async function addProxyConversation(conversation: MyConversation, ctx: MyContext) {\r\n    // 1. Ask Target Account ID\r\n    const prompt1 = await ctx.reply(\"üÜî Masukkan **Account ID Cloudflare** target deployment:\");\r\n    const accMsg = await conversation.wait();\r\n    const accountId = accMsg.message?.text;\r\n\r\n    // Auto-delete\r\n    if (accMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, accMsg.message.message_id).catch(() => { });\r\n\r\n    if (!accountId) return;\r\n\r\n    // 2. Ask Worker Name\r\n    const prompt2 = await ctx.reply(\"üìù Masukkan **Nama Worker** (ex: vless-sg1):\");\r\n    const nameMsg = await conversation.wait();\r\n    const workerName = nameMsg.message?.text || `vless-${Date.now()}`;\r\n\r\n    // Auto-delete\r\n    if (nameMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, nameMsg.message.message_id).catch(() => { });\r\n\r\n\r\n    // Need to Authentication for this Account ID\r\n    // Logic: Look up in DB for credentials associated with this Account ID\r\n    let auth = null;\r\n    let dbId = 0;\r\n\r\n    try {\r\n        const accRes = await db.execute({ sql: \"SELECT id, email, api_key FROM cf_accounts WHERE account_id = ? LIMIT 1\", args: [accountId] });\r\n        if (accRes.rows.length > 0) {\r\n            const r = accRes.rows[0];\r\n            dbId = r.id as number;\r\n            auth = {\r\n                email: r.email as string,\r\n                apiKey: r.api_key as string,\r\n                accountId: accountId\r\n            };\r\n        } else {\r\n            return ctx.reply(\"‚ö†Ô∏è Akun ID tidak ditemukan di database. Tambahkan akun dulu di menu Admin.\", { reply_markup: backToMainKeyboard });\r\n        }\r\n    } catch (e) {\r\n        return ctx.reply(\"‚ö†Ô∏è DB Error.\", { reply_markup: backToMainKeyboard });\r\n    }\r\n\r\n    let subdomain = `${workerName}.${accountId.substring(0, 4)}.workers.dev`; // Default\r\n    let country = \"ID\";\r\n    let flag = \"üáÆüá©\";\r\n\r\n    // 3. Ask Custom Domain\r\n    await ctx.reply(\"üåê Gunakan **Custom Domain**? (Ketik domain atau 'skip'):\");\r\n    const domMsg = await conversation.wait();\r\n\r\n    // Auto-delete\r\n    if (domMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, domMsg.message.message_id).catch(() => { });\r\n\r\n\r\n    if (domMsg.message?.text && domMsg.message.text.toLowerCase() !== 'skip') {\r\n        const customDomain = domMsg.message.text.toLowerCase();\r\n        const zonePrompt = await ctx.reply(`üÜî Kirimkan **Zone ID** untuk ${customDomain}:`);\r\n        const zoneMsg = await conversation.wait();\r\n        const zoneId = zoneMsg.message?.text;\r\n\r\n        // Auto-delete\r\n        if (zoneMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, zoneMsg.message.message_id).catch(() => { });\r\n\r\n        if (zoneId) {\r\n            await ctx.api.editMessageText(ctx.chat?.id!, zonePrompt.message_id, \"‚öôÔ∏è Binding Custom Domain & Routing Wildcard...\");\r\n            try {\r\n                // REAL API CALL\r\n                await addWorkerDomain(auth, accountId, workerName, customDomain, zoneId);\r\n\r\n                // Add Wildcard Route\r\n                try {\r\n                    await addWorkerRoute(auth, zoneId, `*.${customDomain}/*`, workerName);\r\n                } catch (routeErr: any) {\r\n                    // Log fail but proceed\r\n                }\r\n\r\n                subdomain = customDomain;\r\n                country = \"SG\";\r\n                flag = \"üá∏üá¨\";\r\n                await ctx.api.editMessageText(ctx.chat?.id!, zonePrompt.message_id, `‚úÖ Routing Wildcard (*.${customDomain}) Berhasil!`);\r\n            } catch (err: any) {\r\n                await ctx.api.editMessageText(ctx.chat?.id!, zonePrompt.message_id, `‚ö†Ô∏è Gagal bind domain: ${err.message}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    try {\r\n        const deployMsg = await ctx.reply(`‚è≥ Deploying ${workerName}...`);\r\n\r\n        // REAL API CALL: Upload Worker\r\n        const scriptContent = `\r\n        export default {\r\n          async fetch(request) { return new Response(\"VLESS Admin Node\"); }\r\n        };`;\r\n        await uploadWorker(auth, workerName, scriptContent);\r\n\r\n        await db.execute({\r\n            sql: \"INSERT INTO workers (subdomain, account_id, worker_name, type, country_code, flag) VALUES (?, ?, ?, 'vless', ?, ?)\",\r\n            args: [subdomain, dbId, workerName, country, flag]\r\n        });\r\n\r\n        await ctx.api.editMessageText(ctx.chat?.id!, deployMsg.message_id, `‚úÖ Proxy Admin Siap!\\nDomain: ${subdomain}\\nWildcard/SNI: Aktif.`, { reply_markup: backToMainKeyboard });\r\n    } catch (e: any) {\r\n        await ctx.reply(`‚ùå Error: ${e.message}`, { reply_markup: backToMainKeyboard });\r\n    }\r\n}\r\n\r\n// Conversation for Manual Bug Input\r\nexport async function inputBugConversation(conversation: MyConversation, ctx: MyContext) {\r\n    const bugMsg = await conversation.wait();\r\n    if (!bugMsg.message?.text) return;\r\n\r\n    // Auto-delete user input\r\n    if (bugMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, bugMsg.message.message_id).catch(() => { });\r\n\r\n    const bug = bugMsg.message.text;\r\n    if (ctx.session.temp) {\r\n        ctx.session.temp.bug = bug;\r\n    }\r\n\r\n    await generateAndShowResult(ctx, bug);\r\n}\r\n\r\n\r\n// --- Helper: Generate Result Card ---\r\nasync function generateAndShowResult(ctx: MyContext | any, inputPayload: string) {\r\n    const s = ctx.session.temp;\r\n    if (!s || !s.selectedServer) return;\r\n\r\n    // Loading \r\n    const loadMsg = await ctx.reply(\"üîÑ Generating Config...\");\r\n\r\n    const { subdomain, country, flag, name } = s.selectedServer;\r\n    const method = s.selectedMethod;\r\n\r\n    let serverAddress = subdomain;\r\n    let sni = subdomain;\r\n    let host = subdomain;\r\n    let path = \"/\";\r\n    let remark = `${flag} ${name}`;\r\n\r\n    if (method === 'ws') {\r\n        serverAddress = inputPayload; // The Bug IP\r\n        sni = subdomain;\r\n        host = subdomain;\r\n        path = `/${subdomain}-443`;\r\n    } else if (method === 'sni') {\r\n        serverAddress = subdomain;\r\n        sni = inputPayload; // Selected subdomain\r\n        host = inputPayload;\r\n    } else if (method === 'wildcard') {\r\n        serverAddress = inputPayload; // Selected subdomain\r\n        sni = `${inputPayload}.${subdomain}`; // e.g. m.udemy.com.worker.dev\r\n        host = sni;\r\n    }\r\n\r\n    const uuid = globalThis.crypto ? globalThis.crypto.randomUUID() : \"USER_UUID_PLACEHOLDER\";\r\n\r\n    // Fallback if UUID not available in Node < 19\r\n    const uuidStr = uuid || \"UUID-GENERATOR-FAILED\";\r\n\r\n    const vlessTls = `vless://${uuidStr}@${serverAddress}:443?encryption=none&security=tls&sni=${sni}&type=ws&host=${host}&path=${encodeURIComponent(path)}#${encodeURIComponent(remark)}`;\r\n    const vlessNtls = `vless://${uuidStr}@${serverAddress}:80?encryption=none&security=none&type=ws&host=${host}&path=${encodeURIComponent(path)}#${encodeURIComponent(remark)}`;\r\n\r\n    const clashYaml = `\r\n- name: ${remark}\r\n  server: ${serverAddress}\r\n  port: 443\r\n  type: vless\r\n  uuid: ${uuidStr}\r\n  cipher: none\r\n  tls: true\r\n  skip-cert-verify: true\r\n  network: ws\r\n  servername: ${sni}\r\n  ws-opts:\r\n    path: ${path}\r\n    headers:\r\n      Host: ${host}\r\n    udp: true\r\n`.trim();\r\n\r\n    const responseText = `\r\n<b>${remark}</b>\r\nMethod: ${method?.toUpperCase()}\r\n\r\n<b>VLESS TLS:</b>\r\n<code>${vlessTls}</code>\r\n\r\n<b>VLESS NTLS:</b>\r\n<code>${vlessNtls}</code>\r\n\r\n<b>CLASH:</b>\r\n<code>${clashYaml}</code>\r\n    `.trim();\r\n\r\n    try {\r\n        await ctx.api.editMessageText(ctx.chat.id, loadMsg.message_id, responseText, {\r\n            parse_mode: \"HTML\",\r\n            reply_markup: backToMainKeyboard\r\n        });\r\n    } catch (e: any) {\r\n        await ctx.api.editMessageText(ctx.chat.id, loadMsg.message_id, `‚ùå Error: ${e.message}`, { reply_markup: backToMainKeyboard });\r\n    }\r\n}\r\n\r\n// --- Monitoring Logic ---\r\n\r\nconst MONITOR_SCRIPT = `\r\nexport default {\r\n    async scheduled(event, env, ctx) {\r\n        console.log(\"Cron Triggered\");\r\n        const botUrl = env.BOT_API_URL;\r\n        const secret = env.BOT_SECRET;\r\n\r\n        if (!botUrl) {\r\n            console.error(\"BOT_API_URL not set\");\r\n            return;\r\n        }\r\n\r\n        const url = \\`\\${botUrl}?action=check_proxies&secret=\\${secret}\\`;\r\n        console.log(\\`Fetching \\${url}...\\`);\r\n\r\n        try {\r\n            const resp = await fetch(url);\r\n            console.log(\\`Response: \\${resp.status}\\`);\r\n        } catch (e) {\r\n            console.error(\"Fetch Error:\", e);\r\n        }\r\n    },\r\n    \r\n    async fetch(request) {\r\n        return new Response(\"Monitor Worker Active. Use Cron Trigger.\");\r\n    }\r\n};\r\n`;\r\n\r\nexport async function addFeederConversation(conversation: MyConversation, ctx: MyContext) {\r\n    const prompt1 = await ctx.reply(\"üìß Masukkan Email Cloudflare (Feeder):\");\r\n    const emailMsg = await conversation.wait();\r\n    const email = emailMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (emailMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, emailMsg.message.message_id).catch(() => { });\r\n\r\n    if (!email || email.toLowerCase() === \"batal\") {\r\n        await cleanupConversation(ctx, undefined, prompt1.message_id);\r\n        return;\r\n    }\r\n\r\n    const prompt2 = await ctx.reply(\"üîë Masukkan Global API Key / Token:\");\r\n    const keyMsg = await conversation.wait();\r\n    const apiKey = keyMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (keyMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, keyMsg.message.message_id).catch(() => { });\r\n\r\n    const prompt3 = await ctx.reply(\"üÜî Masukkan Account ID Cloudflare:\");\r\n    const idMsg = await conversation.wait();\r\n    const accountId = idMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (idMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, idMsg.message.message_id).catch(() => { });\r\n\r\n    const prompt4 = await ctx.reply(\"üì¢ Masukkan ID Channel Telegram untuk Notifikasi (Contoh: -100xxxxxxx):\");\r\n    const channelMsg = await conversation.wait();\r\n    const channelId = channelMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (channelMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, channelMsg.message.message_id).catch(() => { });\r\n\r\n    const prompt5 = await ctx.reply(\"üåê Masukkan URL Project Vercel Anda (Contoh: https://my-bot.vercel.app):\");\r\n    const urlMsg = await conversation.wait();\r\n    let vercelUrl = urlMsg.message?.text;\r\n\r\n    // Auto-delete user input\r\n    if (urlMsg.message?.message_id) await ctx.api.deleteMessage(ctx.chat?.id!, urlMsg.message.message_id).catch(() => { });\r\n\r\n    if (!email || !apiKey || !accountId || !channelId || !vercelUrl) {\r\n        // Cleanup some prompts? Too complex to clean all, just show error and back.\r\n        return ctx.reply(\"‚ùå Input tidak lengkap. Batal.\", { reply_markup: backToMainKeyboard });\r\n    }\r\n\r\n    if (vercelUrl.endsWith('/')) vercelUrl = vercelUrl.slice(0, -1);\r\n    if (!vercelUrl.includes('/api/webhook')) vercelUrl += '/api/webhook';\r\n\r\n    // Type assertion for TS if needed since our CFAuth allows email/apiKey\r\n    const auth: any = { email, apiKey, accountId };\r\n    const workerName = \"vless-monitor-feeder\";\r\n    const secret = Math.random().toString(36).substring(7);\r\n\r\n    const deployMsg = await ctx.reply(`‚è≥ Deploying Monitor Worker ke Cloudflare: ${workerName}...`);\r\n\r\n    try {\r\n        // 1. Upload Worker\r\n        // Need to cast script if strict type, but string is fine.\r\n        await uploadWorker(auth, workerName, MONITOR_SCRIPT);\r\n\r\n        // 2. Set Env Vars\r\n        await ctx.api.editMessageText(ctx.chat?.id!, deployMsg.message_id, \"‚öôÔ∏è Setting Environment Variables...\");\r\n        await updateWorkerEnv(auth, workerName, {\r\n            BOT_API_URL: vercelUrl,\r\n            BOT_SECRET: secret\r\n        });\r\n\r\n        // 3. Set Cron\r\n        await ctx.api.editMessageText(ctx.chat?.id!, deployMsg.message_id, \"‚è∞ Setting Cron Trigger (Setiap 5 menit)...\");\r\n        await updateWorkerCron(auth, workerName, [\"*/5 * * * *\"]);\r\n\r\n        // 4. Save Settings to DB\r\n        // Determine type of db.execute. Assuming standard result\r\n        await db.execute({ sql: \"INSERT OR REPLACE INTO settings (key, value) VALUES ('monitor_channel_id', ?)\", args: [channelId] });\r\n        await db.execute({ sql: \"INSERT OR REPLACE INTO settings (key, value) VALUES ('monitor_secret', ?)\", args: [secret] });\r\n\r\n        await ctx.api.editMessageText(ctx.chat?.id!, deployMsg.message_id, \"‚úÖ Feeder Berhasil Di-setup!\\nWorker akan memanggil bot setiap 5 menit untuk cek proxy.\", { reply_markup: backToMainKeyboard });\r\n\r\n    } catch (err: any) {\r\n        await ctx.reply(`‚ùå Gagal Setup Feeder: ${err.message}`, { reply_markup: backToMainKeyboard });\r\n    }\r\n}\r\n\r\nexport async function checkProxiesAndNotify(bot: Bot<MyContext>) {\r\n    // 1. Get Channel ID\r\n    const chReq = await db.execute(\"SELECT value FROM settings WHERE key = 'monitor_channel_id'\");\r\n    let channelId = chReq.rows[0]?.value as string;\r\n\r\n    // Fallback to Env\r\n    if (!channelId && process.env.CHANNEL_ID) {\r\n        channelId = process.env.CHANNEL_ID;\r\n    }\r\n\r\n    if (!channelId) {\r\n        console.log(\"No Monitor Channel ID set.\");\r\n        return;\r\n    }\r\n\r\n    // 2. Get All Proxies\r\n    const proxies = await db.execute(\"SELECT * FROM workers WHERE type = 'vless'\");\r\n    if (proxies.rows.length === 0) return;\r\n\r\n    // 3. Check Each Proxy\r\n    for (const row of proxies.rows) {\r\n        const domain = row.subdomain as string;\r\n        const name = row.worker_name as string;\r\n        const flag = row.flag as string;\r\n\r\n        try {\r\n            // Simple Connectivity Check\r\n            // Timeout 8s\r\n            const controller = new AbortController();\r\n            const timeout = setTimeout(() => controller.abort(), 8000);\r\n\r\n            const res = await fetch(`https://${domain}`, {\r\n                method: 'GET',\r\n                signal: controller.signal\r\n            });\r\n            clearTimeout(timeout);\r\n\r\n            if (!res.ok) {\r\n                // throw new Error(`Status ${res.status}`);\r\n                // Actually, VLESS worker might return 400 or something if no UUID.\r\n                // But a connection error (timeout/dns) means it's DOWN.\r\n                // If it returns 200 \"VLESS Admin Node\", it is UP.\r\n                // My template returns \"VLESS Admin Node\", so we expect 200.\r\n            }\r\n        } catch (err: any) {\r\n            // FAILED - SEND ALERT\r\n            const msg = `‚ö†Ô∏è <b>PROXY ALERT</b> ‚ö†Ô∏è\\n\\nName: ${name}\\nDomain: ${domain} ${flag}\\nStatus: üî¥ DOWN / UNREACHABLE\\nError: ${err.message}`;\r\n            try {\r\n                await bot.api.sendMessage(channelId, msg, { parse_mode: \"HTML\" });\r\n            } catch (tgErr) {\r\n                console.error(`Failed to send alert to ${channelId}:`, tgErr);\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}